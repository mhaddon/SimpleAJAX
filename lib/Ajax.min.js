"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var privateAttributesOfAjax=new WeakMap,privateMethodsOfAjax={_createUrlString:function(a,b,c,d){return"GET"===c.toUpperCase()&&d&&Object.keys(d).length?b+"?"+Ajax.convertDataToString(d):b},_sendRequest:function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"/",c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"get",d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{},e=privateMethodsOfAjax._createRequestObject(a,privateMethodsOfAjax._createUrlString(a,b,c,d),c);if("POST"===c.toUpperCase()){e.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var f=document.querySelector("meta[name='_csrf']").getAttribute("content"),g=document.querySelector("meta[name='_csrf_header']").getAttribute("content");e.setRequestHeader(g,f),null===d?e.send():e.send(Ajax.convertDataToString(d))}else e.send()},_createRequestObject:function(a,b,c){var d=new XMLHttpRequest;return d.open(c.toUpperCase(),b,!0),d.onerror=function(){privateAttributesOfAjax.get(a)._response=d.response;var b,c=!0,e=!1;try{for(var f,g,h=privateAttributesOfAjax.get(a)._failureEvents[Symbol.iterator]();!(c=(f=h.next()).done);c=!0)g=f.value,g(privateAttributesOfAjax.get(a)._response)}catch(a){e=!0,b=a}finally{try{!c&&h.return&&h.return()}finally{if(e)throw b}}privateAttributesOfAjax.get(a)._status=d.status||408},d.onload=function(){if(privateAttributesOfAjax.get(a)._status=d.status,privateAttributesOfAjax.get(a)._response=d.responseText,a.isSuccess()){var b,c=!0,e=!1;try{for(var f,g,h=privateAttributesOfAjax.get(a)._successEvents[Symbol.iterator]();!(c=(f=h.next()).done);c=!0)g=f.value,g(privateAttributesOfAjax.get(a)._response)}catch(a){e=!0,b=a}finally{try{!c&&h.return&&h.return()}finally{if(e)throw b}}}else d.onerror();var i,j=!0,k=!1;try{for(var l,m,n=privateAttributesOfAjax.get(a)._completeEvents[Symbol.iterator]();!(j=(l=n.next()).done);j=!0)m=l.value,m(privateAttributesOfAjax.get(a)._response)}catch(a){k=!0,i=a}finally{try{!j&&n.return&&n.return()}finally{if(k)throw i}}privateAttributesOfAjax.get(a)._complete=!0},d}},Ajax=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"/",c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"get",d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};(0,_classCallCheck3.default)(this,a),privateAttributesOfAjax.set(this,{}),_initialiseProps.call(this),privateAttributesOfAjax.get(this)._successEvents=[],privateAttributesOfAjax.get(this)._failureEvents=[],privateAttributesOfAjax.get(this)._completeEvents=[],privateAttributesOfAjax.get(this)._complete=!1,privateAttributesOfAjax.get(this)._status=200,privateAttributesOfAjax.get(this)._response="",privateMethodsOfAjax._sendRequest(this,b.replace(/\/\//g,"/"),c,d)}return(0,_createClass3.default)(a,[{key:"onSuccess",value:function(a){return this.isSuccess()&&privateAttributesOfAjax.get(this)._complete?a(privateAttributesOfAjax.get(this)._response):privateAttributesOfAjax.get(this)._successEvents.push(a),this}},{key:"onFailure",value:function(a){return!this.isSuccess()&&privateAttributesOfAjax.get(this)._complete?a(privateAttributesOfAjax.get(this)._response):privateAttributesOfAjax.get(this)._failureEvents.push(a),this}},{key:"onComplete",value:function(a){return privateAttributesOfAjax.get(this)._complete?a(privateAttributesOfAjax.get(this)._response):privateAttributesOfAjax.get(this)._completeEvents.push(a),this}}],[{key:"convertDataToString",value:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c+"="+encodeURIComponent(a[c]));return b.join("&")}},{key:"createPromise",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"/",b=this,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"get",d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(e,f){b.create(a,c,d).onSuccess(function(a){e(a)}).onFailure(function(a){f(a)})})}}]),a}();Ajax.create=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"/",b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"get",c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};return new Ajax(a,b,c)};var _initialiseProps=function(){var a=this;this.isSuccess=function(){return 200<=a._status&&400>a._status},this.isClientError=function(){return 400<=a._status&&500>a._status},this.isServerError=function(){return 500<=a._status&&600>a._status}};exports.default=Ajax;